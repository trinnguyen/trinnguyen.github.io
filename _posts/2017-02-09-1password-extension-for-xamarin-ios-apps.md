---
title: 1Password Extension for Xamarin.iOS apps
id: 42
date: '2017-02-09 00:00:00'
author: trinnguyen
layout: post
permalink: "/1password-extension-for-xamarin-ios-apps/"
categories:
- Xamarin
tags:
- 1password
- 1password-extension
- objective-sharpie
- xamarin
- xamarin.ios
---

<img class="alignright wp-image-53" src="/assets/2017/02/logo-1password-xamarin-150x150.png" alt="1Password Logo" width="120" height="120" />

1Password is one of my favorite application on Mac and iPhone. It&#8217;s working pretty well across devices, browsers (Chrome/Safari in my cases). With one unique master password, 1Password enables different strong, complex passwords to all online socials.

There is a bunch of iOS applications on Store that use 1Password login side already, see here: <a href="https://blog.agilebits.com/1password-apps" target="_blank">https://blog.agilebits.com/1password-apps</a> . Most of the popular apps are named here. Below are how it looks on Dropbox and Pluralsight (notice the 1Password icon?)

 <img class="alignleft wp-image-51 size-medium" src="/assets/2017/02/1password-xamarin-dropbox-169x300.png" alt="1Password Extension for Xamarin.iOS apps - Demo Dropbox" width="169" height="300" /><img class="alignnone wp-image-52 size-medium" src="/assets/2017/02/1password-xamarin-pluralsight-169x300.png" alt="1Password Extension for Xamarin.iOS apps - Demo Pluralsight" width="169" height="300" />

&nbsp;

How do we add this extension to our iOS application? There is &#8220;1Password Extension for iOS Apps&#8221; that helps iOS developers support using 1Password login inside their applications, check out <a href="https://github.com/AgileBits/onepassword-app-extension" target="_blank">https://github.com/AgileBits/onepassword-app-extension</a>, but only for Objective-C and Swift. Well, how about Xamarin?

## Xamarin.iOS Binding for 1Password Extensions

Yes, I made the bindings library for it, check this Nuget package: <a href="https://www.nuget.org/packages/Xamarin.1PasswordExtension" target="_blank">1PasswordExtension for Xamarin.iOS</a>

The source code is hosted on Github: <a href="https://github.com/trinnguyen/onepassword-app-extension-xamarin" target="_blank">https://github.com/trinnguyen/onepassword-app-extension-xamarin</a>

Anyone who is curious about how it is built can look at there and built their own DLL too, it fetches the latest Release of the original Objective-C library to build CocoaTouch framework.

_The binding ApiDefinitions class is generated by using Objective Sharpie with CocoaPods components, I hope to have some time to write about it later._

## Integrate to 1Password to your Xamarin.iOS app

### 1. Install Nuget package and add assets

Simply install the Nuget package (bindings of 1Password Extension) to Xamarin.iOS project

{% highlight csharp %}
Install-Package Xamarin.1PasswordExtension
{% endhighlight %}

Add **1Password.xcassets** catalog**** to the application bundle, these images are provided by 1Password Team to help user recognize the button. This resource can be found on <a href="https://github.com/trinnguyen/onepassword-app-extension-xamarin" target="_blank">my Github repo</a> or the <a href="https://github.com/AgileBits/onepassword-app-extension" target="_blank">original library</a>

<img class="size-medium wp-image-62 aligncenter" src="/assets/2017/02/1password-extension-xamarin-add-assets-300x133.png" alt="" width="300" height="133" srcset="/assets/2017/02/1password-extension-xamarin-add-assets-300x133.png 300w, /assets/2017/02/1password-extension-xamarin-add-assets.png 341w" sizes="(max-width: 300px) 85vw, 300px" />

### 2. Add LSApplicationQueriesSchemes in Info.plist

1Password extension uses _UIApplication.CanOpenURL_ to check whether the app extension is available, with value &#8220;_org-appextension-feature-password-management_&#8220;, thus any application that supports password management actions can be visible.

One iOS 9+, application need to whitelist **org-appextension-feature-password-management** in **LSApplicationQueriesSchemes**

  * Open your **Info.plist** file, tab **Source**
  * Add new row: **LSApplicationQueriesSchemes** (array) with item: **org-appextension-feature-password-management**
  <img class="wp-image-60 size-full aligncenter" src="/assets/2017/02/1password-extension-xamarin-infoplist.png" width="671" height="80" srcset="/assets/2017/02/1password-extension-xamarin-infoplist.png 671w, /assets/2017/02/1password-extension-xamarin-infoplist-300x36.png 300w" sizes="(max-width: 709px) 85vw, (max-width: 909px) 67vw, (max-width: 984px) 61vw, (max-width: 1362px) 45vw, 600px" />

### Play with source code

There are 4 use cases that normally integration works, for details <a href="https://github.com/AgileBits/onepassword-app-extension#use-case-1-native-app-login" target="_blank">check out document of the original library</a>. In this article, I will show how it works on Xamarin with C# code

A demo Xamarin.iOS application is provided on <a href="https://github.com/trinnguyen/onepassword-app-extension-xamarin" target="_blank">my Github repo</a>, covers 3 use cases. For webView, check below sample code.

#### check app Extension is available

Hide 1Password button if the App Extension is not visible (1Password app is not installed on iOS device yet)

<pre class="lang:default decode:true">this.onePasswordButton.Hidden = !OnePasswordExtension.SharedExtension.IsAppExtensionAvailable;</pre>

#### Use Case #1: Native App Login

{% highlight csharp %}
if (OnePasswordExtension.SharedExtension.IsAppExtensionAvailable)
{
	OnePasswordExtension.SharedExtension.FindLoginForURLString("https://www.acme.com", this, sender, (NSDictionary loginDictionary, NSError error) =&gt; 
	{
		if (loginDictionary == null || loginDictionary.Count == 0)
		{
			if (error.Code != AppExtensionErrorCodes.CancelledByUser)
			{
				System.Diagnostics.Debug.WriteLine(@"Error invoking 1Password App Extension for find login: {0}", error);
			}
			return;
		}

		this.usernameTextField.Text = (NSString)loginDictionary[AppExtensionLoginDictionarykeys.UsernameKey];
		this.passwordTextField.Text = (NSString)loginDictionary[AppExtensionLoginDictionarykeys.PasswordKey];
	});	
}
{% endhighlight %}

#### Use Case #2: New User Registration

{% highlight csharp %}
NSDictionary newLoginDetails = new NSDictionary(
	AppExtensionLoginDictionarykeys.TitleKey, "ACME",
	AppExtensionLoginDictionarykeys.UsernameKey, this.usernameTextField.Text ?? "",
	AppExtensionLoginDictionarykeys.PasswordKey, this.passwordTextField.Text ?? "",
	AppExtensionLoginDictionarykeys.NotesKey, "Saved with the ACME app",
	AppExtensionLoginDictionarykeys.SectionTitleKey, "ACME Browser",
	AppExtensionLoginDictionarykeys.FieldsKey, new NSDictionary("firstname", this.firstnameTextField.Text ?? "",
													"lastname", this.lastnameTextField.Text ?? "")
);

// The password generation options are optional, but are very handy in case you have strict rules about password lengths, symbols and digits.
NSDictionary passwordGenerationOptions = new NSDictionary(
	// The minimum password length can be 4 or more.
	AppExtensionPasswordGeneratorOptions.MinLengthKey, 8,

	// The maximum password length can be 50 or less.
	AppExtensionPasswordGeneratorOptions.MaxLengthKey, 30,

	// If YES, the 1Password will guarantee that the generated password will contain at least one digit (number between 0 and 9). Passing NO will not exclude digits from the generated password.
	AppExtensionPasswordGeneratorOptions.RequireDigitsKey, true,

	// If YES, the 1Password will guarantee that the generated password will contain at least one symbol (See the list bellow). Passing NO with will exclude symbols from the generated password.
	AppExtensionPasswordGeneratorOptions.RequireSymbolsKey, true,

	// Here are all the symbols available in the the 1Password Password Generator:
	// !#$%^&*()_-+=|[]{}'\";.,&gt;?/~`
	// The string for AppExtensionPasswordGeneratorOptions.ForbiddenCharactersKey should contain the symbols and characters that you wish 1Password to exclude from the generated password.
	AppExtensionPasswordGeneratorOptions.ForbiddenCharactersKey, "!#$%/0lIO"
);
OnePasswordExtension.SharedExtension.StoreLoginForURLString("https://www.acme.com", newLoginDetails, passwordGenerationOptions, this, sender, (NSDictionary loginDictionary, NSError error) =&gt;
{
	if (loginDictionary == null || loginDictionary.Count == 0)
	{
		if (error.Code != AppExtensionErrorCodes.CancelledByUser)
		{
			System.Diagnostics.Debug.WriteLine("Failed to use 1Password App Extension to save a new Login: {0}", error);
		}
		return;
	}

	this.usernameTextField.Text = (NSString)loginDictionary[AppExtensionLoginDictionarykeys.UsernameKey] ?? "";
	this.passwordTextField.Text = (NSString)loginDictionary[AppExtensionLoginDictionarykeys.PasswordKey] ?? "";
	this.firstnameTextField.Text = (NSString)((NSDictionary)loginDictionary[AppExtensionLoginDictionarykeys.ReturnedFieldsKey])["firstname"] ?? "";
	this.lastnameTextField.Text = (NSString)((NSDictionary)loginDictionary[AppExtensionLoginDictionarykeys.ReturnedFieldsKey])["lastname"] ?? "";
	// retrieve any additional fields that were passed in newLoginDetails dictionary
});
{% endhighlight %}

#### Use Case #3: Change Password

{% highlight csharp %}
string changedPassword = this.freshPasswordTextField.Text ?? "";
string oldPassword = this.oldPasswordTextField.Text ?? "";
string confirmationPassword = this.confirmPasswordTextField.Text ?? "";

// Validate that the new password and the old password are not the same.
if (oldPassword.Length &gt; 0 && oldPassword.Equals(changedPassword))
{
	this.ShowChangePasswordFailedAlertWithMessage("The old and the new password must not be the same");
	return;
}

// Validate that the new and confirmation passwords match.
if (!changedPassword.Equals(confirmationPassword))
{
	this.ShowChangePasswordFailedAlertWithMessage("The new passwords and the confirmation password must match");
	return;
}

NSDictionary loginDetails = new NSDictionary(
	AppExtensionLoginDictionarykeys.TitleKey, "ACME", // Optional, used for the third schenario only
	AppExtensionLoginDictionarykeys.UsernameKey, "aUsername", // Optional, used for the third schenario only
	AppExtensionLoginDictionarykeys.PasswordKey, changedPassword,
	AppExtensionLoginDictionarykeys.OldPasswordKey, oldPassword,
	AppExtensionLoginDictionarykeys.NotesKey, "Saved with the ACME app"// Optional, used for the third schenario only
);

// The password generation options are optional, but are very handy in case you have strict rules about password lengths, symbols and digits.
NSDictionary passwordGenerationOptions = new NSDictionary(
	// The minimum password length can be 4 or more.
	AppExtensionPasswordGeneratorOptions.MinLengthKey, 8,

	// The maximum password length can be 50 or less.
	AppExtensionPasswordGeneratorOptions.MaxLengthKey, 30,

	// If YES, the 1Password will guarantee that the generated password will contain at least one digit (number between 0 and 9). Passing NO will not exclude digits from the generated password.
	AppExtensionPasswordGeneratorOptions.RequireDigitsKey, true,

	// If YES, the 1Password will guarantee that the generated password will contain at least one symbol (See the list bellow). Passing NO with will exclude symbols from the generated password.
	AppExtensionPasswordGeneratorOptions.RequireSymbolsKey, true,

	// Here are all the symbols available in the the 1Password Password Generator:
	// !#$%^&*()_-+=|[]{}'\";.,&gt;?/~`
	// The string for AppExtensionPasswordGeneratorOptions.ForbiddenCharactersKey should contain the symbols and characters that you wish 1Password to exclude from the generated password.
	AppExtensionPasswordGeneratorOptions.ForbiddenCharactersKey, "!#$%/0lIO"
);

OnePasswordExtension.SharedExtension.ChangePasswordForLoginForURLString("https://www.acme.com", loginDetails, passwordGenerationOptions, this, sender, (NSDictionary loginDictionary, NSError error) =&gt;
{
	if (loginDictionary == null || loginDictionary.Count == 0)
	{
		if (error.Code != AppExtensionErrorCodes.CancelledByUser)
		{
			System.Diagnostics.Debug.WriteLine("Error invoking 1Password App Extension for find login, {0}", error);
		}
		return;
	}

	this.oldPasswordTextField.Text = (NSString)loginDictionary[AppExtensionLoginDictionarykeys.OldPasswordKey];
	this.freshPasswordTextField.Text = (NSString)loginDictionary[AppExtensionLoginDictionarykeys.PasswordKey];
	this.confirmPasswordTextField.Text = (NSString)loginDictionary[AppExtensionLoginDictionarykeys.PasswordKey];
});
{% endhighlight %}

#### Use Case #4: Web View Filling

{% highlight csharp %}
OnePasswordExtension.SharedExtension.FillItemIntoWebView(webView, this, sender, false, (bool success, NSError error) =&gt; 
{
	if (!success)
	{
		System.Diagnostics.Debug.WriteLine("Failed to fill into webview: {0}", error);
	}	
});
{% endhighlight %}